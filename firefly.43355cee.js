const e={curveIntervalMin:300,curveIntervalMax:1700,initialDistanceMultiplier:1,nodeDistanceMin:.01,nodeDistanceMax:.1,controlPointWeightMin:.1,controlPointWeightMax:.8,controlPointOffsetMin:.2,controlPointOffsetMax:2,movementSpeed:.2,frameTime:16.67,fireflySize:10,numFireflies:500,redundancyFactor:2,fftSize:1024,blinkIntervalMin:100,blinkIntervalMax:1e3,loudnessScaleMin:25,loudnessScaleMax:300,loudnessThreshold:.25,lifespanThreshold:.75,responseTypeBelow:"linear",responseTypeAbove:"hyperExponential",debugFlightPath:!0};let n=null,t=null,i=null,r=null,a=null;const o=[];let l=[],c=[];const s=document.getElementById("fireflyCanvas"),d=s.getContext("2d");function h(e,n,t){return Math.max(n,Math.min(t,e))}function g(e){return e<.5?2*e*e:-1+(4-2*e)*e}function u({originX:n=0,originY:t=0,targetX:i=0,targetY:r=0,distance:a=1,weightMin:o=e.controlPointWeightMin,weightMax:l=e.controlPointWeightMax,offsetMin:c=e.controlPointOffsetMin,offsetMax:s=e.controlPointOffsetMax}){let d=o+Math.random()*(l-o),h=a*(c+Math.random()*(s-c)),g=i-n,u=r-t,f=.5>Math.random()?1:-1,M=0===g&&0===u?Math.random()*Math.PI*2:Math.atan2(u,g)+f*Math.PI/2;return{controlX:n+d*(i-n)+Math.cos(M)*h,controlY:t+d*(r-t)+Math.sin(M)*h}}s.width=window.innerWidth,s.height=window.innerHeight,document.getElementById("audioUpload").addEventListener("change",async f=>{let M=f.target.files[0];if(M){n=new(window.AudioContext||window.webkitAudioContext);let f=await M.arrayBuffer(),p=await n.decodeAudioData(f);(t=n.createBufferSource()).buffer=p;let m=n.createChannelSplitter(2);i=n.createAnalyser(),r=n.createAnalyser(),i.fftSize=1024,r.fftSize=1024,t.connect(m),m.connect(i,0),m.connect(r,1),t.connect(n.destination),i.fftSize=e.fftSize,r.fftSize=e.fftSize,l=new Uint8Array(i.frequencyBinCount),c=new Uint8Array(r.frequencyBinCount);for(let n=0;n<e.numFireflies;n++){let t=n%(i.frequencyBinCount/e.redundancyFactor),r=n%2==0,a=t/(i.frequencyBinCount/e.redundancyFactor),l=r?window.innerWidth*(.5-.5*a):window.innerWidth*(.5+.5*a),c=window.innerHeight/2;o.push({frequencyIndex:t,channel:n%2==0?"left":"right",originX:l,originY:c,x:l,y:c,size:e.fireflySize,glowIntensity:0,lifeSpan:0,fixedLoudness:0,curveTimer:0,curveInterval:0,targetX:0,targetY:0,controlX:0,controlY:0,curveProgress:0})}console.log("Audio loaded and fireflies initialized."),t.start(),t.onended=()=>cancelAnimationFrame(a),function n(){i&&r&&(i.getByteFrequencyData(l),r.getByteFrequencyData(c)),o.forEach(n=>{let t="left"===n.channel?l:c;if(n.lifeSpan<=0&&n.blinkTimer>=n.blinkInterval&&(function(n,t){if(n.fixedLoudness=t[n.frequencyIndex]/255,n.fixedLoudness<e.loudnessThreshold){n.lifeSpan=0;return}let i=function(n){let t=e.lifespanThreshold,i=e.responseTypeBelow,r=e.responseTypeAbove,a=e=>{switch(i){case"linear":return e/t;case"logarithmic":return Math.log(1+e/t)/Math.log(2);case"quadratic":return Math.pow(e/t,2);case"cubic":return Math.pow(e/t,3);case"exponential":return Math.exp(e/t)-1;case"hyperExponential":return(Math.exp(e/t)-1)*2;default:return e}};if(n<t)return a(n);{let e=a(t);return((e,t)=>{switch(r){case"linear":return t+e;case"logarithmic":return t+Math.log(1+e)/Math.log(2);case"quadratic":return t+Math.pow(e,2);case"cubic":return t+3*Math.pow(e,3);case"exponential":return t+(Math.exp(e)-1);case"hyperExponential":return t+(Math.exp(e)-1)*2;default:return n}})((n-t)/(1-t),e)}}(n.fixedLoudness);n.lifeSpan=e.loudnessScaleMin+i*(e.loudnessScaleMax-e.loudnessScaleMin),n.pointOriginX=n.originX,n.pointOriginY=n.originY,n.x=n.originX,n.y=n.originY;let r=Math.min(window.innerWidth,window.innerHeight)*(e.nodeDistanceMin+Math.random()*(e.nodeDistanceMax-e.nodeDistanceMin))*(1+n.fixedLoudness)*e.initialDistanceMultiplier,a=Math.PI/180*((.5>Math.random()?-90:90)+(40*Math.random()-20));n.targetX=h(n.x+r*Math.cos(a),0,window.innerWidth),n.targetY=h(n.y+r*Math.sin(a),0,window.innerHeight);let{controlX:o,controlY:l}=u({originX:n.pointOriginX,originY:n.pointOriginY,targetX:n.targetX,targetY:n.targetY,distance:r});n.controlX=o,n.controlY=l,n.curveTimer=0,n.curveInterval=e.curveIntervalMin+Math.random()*(e.curveIntervalMax-e.curveIntervalMin),n.glowIntensity=n.fixedLoudness}(n,t),n.blinkTimer=0,n.blinkInterval=e.blinkIntervalMin+Math.random()*(e.blinkIntervalMax-e.blinkIntervalMin),n.blinkProgress=0),n.curveTimer+=e.frameTime,n.curveTimer>=n.curveInterval&&(n.curveTimer=0,function(n){n.pointOriginX=n.x,n.pointOriginY=n.y;let t=Math.min(window.innerWidth,window.innerHeight)*(e.nodeDistanceMin+Math.random()*(e.nodeDistanceMax-e.nodeDistanceMin))*(1+n.fixedLoudness)*e.initialDistanceMultiplier,i=Math.PI/180*(360*Math.random());n.targetX=h(n.pointOriginX+t*Math.cos(i),0,window.innerWidth),n.targetY=h(n.pointOriginY+t*Math.sin(i),0,window.innerHeight);let{controlX:r,controlY:a}=u({originX:n.pointOriginX,originY:n.pointOriginY,targetX:n.targetX,targetY:n.targetY,distance:t});n.controlX=r,n.controlY=a}(n),n.curveProgress=0),n.curveProgress+=e.movementSpeed*e.frameTime/1e3,function({firefly:e,originX:n,originY:t,controlX:i,controlY:r,targetX:a,targetY:o,progress:l}){let c=(e,n,t,i)=>Math.pow(1-i,2)*e+2*(1-i)*i*n+Math.pow(i,2)*t;e.x=c(n,i,a,l),e.y=c(t,r,o,l);let{dx:s,dy:d}={dx:2*(1-l)*(i-n)+2*l*(a-i),dy:2*(1-l)*(a-i)+2*l*(a-n)};e.angle=Math.atan2(d,s)}({firefly:n,originX:n.pointOriginX,originY:n.pointOriginY,controlX:n.controlX,controlY:n.controlY,targetX:n.targetX,targetY:n.targetY,progress:n.curveProgress}),n.blinkTimer<n.blinkInterval){n.blinkTimer+=e.frameTime;let t=n.blinkTimer/n.blinkInterval;n.blinkProgress=t<=.5?g(2*t):g(2-2*t)}else n.blinkTimer=0,n.blinkInterval=e.blinkIntervalMin+Math.random()*(e.blinkIntervalMax-e.blinkIntervalMin);n.lifeSpan>0?n.lifeSpan-=1:n.glowIntensity=0}),d.clearRect(0,0,s.width,s.height),o.forEach((n,t)=>{if(n.lifeSpan>0){let t=2*n.size,i=n.blinkProgress*n.glowIntensity;d.save(),d.translate(n.x,n.y),d.rotate(n.angle);let r=d.createRadialGradient(0,0,0,0,0,t);r.addColorStop(0,`rgba(255, 255, 255, ${i})`),r.addColorStop(1,"rgba(255, 255, 255, 0)"),d.fillStyle=r,d.beginPath(),d.arc(0,0,t,0,2*Math.PI),d.fill();let a=Math.min(i+.25,1);if(d.fillStyle=`rgba(255, 255, 255, ${a})`,d.beginPath(),d.ellipse(0,0,t/6,t/12,0,0,2*Math.PI),d.fill(),d.restore(),e.debugFlightPath){d.stroke(),d.fillStyle="rgba(255, 255, 0, 0.5)",d.beginPath(),d.arc(n.originX,n.originY,n.size/2,0,2*Math.PI),d.fill();let e=Math.atan2(n.targetY-n.y,n.targetX-n.x),t=n.controlX-n.x,i=Math.atan2(n.controlY-n.y,t)-e,r=Math.atan2(Math.sin(i),Math.cos(i));d.fillStyle=r>0?"rgba(0, 0, 255, 0.5)":"rgba(0, 255, 0, 0.5)",d.beginPath(),d.arc(n.controlX,n.controlY,n.size/4,0,2*Math.PI),d.fill(),d.fillStyle="rgba(255, 0, 0, 1)",d.beginPath(),d.arc(n.targetX,n.targetY,n.size/2,0,2*Math.PI),d.fill();let a=n.size/4,o=n.x+Math.cos(n.angle)*n.size*3,l=n.y+Math.sin(n.angle)*n.size*3;d.fillStyle="rgba(255, 255, 255, 0.8)",d.beginPath(),d.arc(o,l,a,0,2*Math.PI),d.fill()}}}),a=requestAnimationFrame(n)}()}});
//# sourceMappingURL=firefly.43355cee.js.map
